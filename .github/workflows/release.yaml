name: release
on:
  release:
    types:
      - published

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build and copy binary
        run: |
          docker build -t efes-base -f ./Docker/efes-base/Dockerfile .
          CONTAINER_ID=$(docker create efes-base)
          mkdir -p ./bin
          docker cp ${CONTAINER_ID}:/usr/local/bin/efes - > ./bin/efes
          docker rm -v ${CONTAINER_ID}
      - name: Upload binary to release
        uses: softprops/action-gh-release@v1
        if: ${{startsWith(github.ref, 'refs/tags/') }}
        with:
            files: ./bin/efes